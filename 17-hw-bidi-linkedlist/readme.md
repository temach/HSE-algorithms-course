# Проект №7: Энхансед Лист: Тесты

## Структура тестов

Тесты представлены в виде платформо-мало-или-почти-независимые кодов для системы тестирования [Google Test][gtest_github] и проекта для Visual Studio 2013 с настроенным тестовым окружением для автоматизации тестирования.

Проект с тестами структурирован в соответствии с принятыми стандартами и содержит следующие каталоги верхнего уровня:

* `/src` — исходники
* `/vs120` — настроенное тестовое окружение для автоматизации тестирования с Visual Studio 2013
* `/CLion` — здесь должно быть настроенное тестовое окружение для CLine, то т.к. это изделие не вышло из стадии "этого изделия", в действительности здесь ничего нет и не будет

## Автоматизация тестов с Visual Studio 2013

Проект с тестом представляет собой обычное консольное приложение без прекомпилируемых заголовков и модуля `main`.
Настройка user-specific параметров проекта осуществляется с помощью т.н. [*property sheets*][vspropsheets], которых для тестов нужно ровно два:

* `/vs120/properties/import/gtest.vc120.props` — таблица свойств, задающая пути для хидеров и статических либ gtest-модулей:
  * `GTEST_INCLUDE_DIR` — путь к хидерам gtest
  * `GTEST_DLIB_DIR` — путь к дебажным либам gtest
* `/vs120/properties/import/xi_enhList.vc120.props` — таблица свойств, задающая пути для хидеров собственно тестируемой библиотеки enhList; этот путь можно было бы задать относительно каталога проекта тестов, но для пущей гибкости он приходит сюда в виде настраиваемой опции

### Настройки проекта

В проекте не должно быть модуля `main`, т.к. вместо него подключается gtest-библиотека с прекомпилированным `main`-ом, содержащим процедуру вызова всех тестов. Это файлик `gtest_maind.lib`, подключаемый в опциях линкера: `Linker → Input → Additional Dependencies`.
Другие символы gtest подключаются аналогично в виде статической либы `gtestd.lib`.
Чтобы компилятор мог найти эти файлы, необходимо добавить путь с каталогом, содержащим их, в виде параметра линкера `Linker → General → Additional Library Directories` (значение `$(GTEST_DLIB_DIR)`).

Каталоги с исходниками тестов, тестируемой библиотеки и тестирующей библиотеки gtest задаются в опциях компилятора (`C/C++ → General → Additional Include Directories`) соответственно как `$(ProjectDir)..\src\`, `$(XI_ENHLIST_INCLUDE_DIR)` и `$(GTEST_INCLUDE_DIR)`.

Также следует установить статическую сборку (без динамических библиотек) — опция `C/C++ → Code Generation → Runtime library` в значение `Multi-threaded Debug (/MTd)`.

### Интеграция с Test Explorer

Для автоматизации запуска тестов и интеграции со встроенными инструментами тестирования рекомендуется установить расширение VS2013 под названием [GoogleTest Runner][gtestrunner_vsext].


[gtest_github]: https://github.com/google/googletest
[vspropsheets]: https://msdn.microsoft.com/en-us/library/a4xbdz1e.aspx
[gtestrunner_vsext]: https://visualstudiogallery.msdn.microsoft.com/9dd47c21-97a6-4369-b326-c562678066f0